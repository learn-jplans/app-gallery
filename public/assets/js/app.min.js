window.App=window.App||{},window.App.SearchPlace={init:function(){this.handler()},handler:function(){$(document).on("change","#searchPlaceType",function(e){console.log("handler..."),App.Maps.mapScriptLoaded()}),$(document).on("mouseover","#places li a",function(e){var a=$(this),o=a.data();App.Maps.bounceMarker(o.id,!0)}),$(document).on("mouseout","#places li a",function(e){var a=$(this),o=a.data();App.Maps.bounceMarker(o.id,!1)})}},$(function(){App.SearchPlace.init()}),window.App=window.App||{},window.App.Maps={$mapContainer:$("#map-canvas"),defaultZoomLevel:10,autoComplete:!1,region:"PH",map:!1,mapCenter:!1,markers:{},mapBounds:!1,userLocation:!1,currentLocation:!1,mapLoaded:!1,selectedLat:0,selectedLng:0,count:0,"default":{lat:13.9490476,lng:121.1579272,location:"Lipa Batangas, PH",zoomLevel:17},init:function(){var e=this;e.loadMapScript()},loadMapScript:function(){var e=document.createElement("script");e.type="text/javascript",e.src="//maps.googleapis.com/maps/api/js?v=3.exp&language=en&sensor=false&libraries=places,geometry&callback=App.Maps.mapScriptLoaded",document.body.appendChild(e)},mapScriptLoaded:function(){var e=this;e.loadMap(e.$mapContainer,null,function(e){e.getInitLocation(),e.mapLoaded=!0})},eventHandler:function(){var e=this;google.maps.event.addListener(e.map,"click",function(a){e.selectedLat=a.latLng.lat(),e.selectedLng=a.latLng.lng(),console.log(e.selectedLat),console.log(e.selectedLng)})},loadMap:function(e,a,o){var n=this;if(a=a||{},0===e.length)return!1;n["default"]=$.extend(n["default"],a),n.mapCenter=new google.maps.LatLng(n["default"].lat,n["default"].lng),n.currentLocation=n.mapCenter;var t={zoom:n["default"].zoomLevel,center:n.mapCenter,scrollwheel:!1,mapTypeControl:!1,panControl:!1,scaleControl:!0,zoomControl:!0,streetViewControl:!1,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.TOP_RIGHT}};e.ready(function(){n.map=new google.maps.Map(e[0],t),"function"==typeof o&&o(n)}),n.eventHandler()},placeDetail:function(){var e={placeId:"ChIJN1t_tDeuEmsRUsoyG83frY4"},a=(new google.maps.InfoWindow,new google.maps.places.PlacesService(this.map));a.getDetails(e,function(e,a){a==google.maps.places.PlacesServiceStatus.OK&&console.log(e)})},getNearbyPlaces:function(){var e=this,a=$("#searchPlaceType option:selected").val(),o={location:this.currentLocation,radius:500,types:[a]};placesList=$("#places");var n=new google.maps.places.PlacesService(e.map);n.nearbySearch(o,function(a,o,n){o==google.maps.places.PlacesServiceStatus.OK&&(e.createMarkers(a),n.hasNextPage)})},createMarkers:function(e){{var a=this;new google.maps.LatLngBounds}console.log(e),placesList.html("");for(var o,n=0;o=e[n];n++){var t=o.geometry.location;a.insertMarker(t,o.id,o),placesList.append('<li><a href="javascript:;" data-id="'+o.id+'">'+o.name+"</a></li>")}},getInitLocation:function(e,a){var o=this;a?(o.mapCenter=new google.maps.LatLng(e,a),o.currentLocation=o.mapCenter,o.userLocation=o.mapCenter,o.map.setZoom(o["default"].zoomLevel),o.map.setCenter(o.mapCenter),o.geolocationInProgress=!1,o.initDefaultGeoInterval=setInterval(function(){o.geolocationInProgress||clearInterval(o.initDefaultGeoInterval)},200)):navigator.geolocation&&(o.geolocationInProgress=!0,navigator.geolocation.getCurrentPosition(function(e){console.log(e),o.mapCenter=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),o.currentLocation=o.mapCenter,o.userLocation=o.mapCenter,o.map.setZoom(o["default"].zoomLevel),o.map.setCenter(o.mapCenter),o.geolocationInProgress=!1,o.getNearbyPlaces()},function(e){o.geolocationInProgress=!1},{maximumAge:6e5,timeout:1e4}),o.initDefaultGeoInterval=setInterval(function(){o.geolocationInProgress||clearInterval(o.initDefaultGeoInterval)},200))},insertMarker:function(e,a,o){var n=this;if(n.mapLoaded){var t={placeId:o.place_id},r=new google.maps.InfoWindow,i=new google.maps.places.PlacesService(n.map),s=new google.maps.Marker({position:e,map:n.map,tag:a});n.markers[String(a)]=s,google.maps.event.addListener(s,"click",function(){i.getDetails(t,function(e,a){a==google.maps.places.PlacesServiceStatus.OK&&(console.log(e),r.setContent(e.adr_address),r.open(n.map,s))})})}else setTimeout(function(){n.insertMarker(e,a)},100)},bounceMarker:function(e,a){var o=this;if("undefined"==typeof o.markers[e])return!1;"undefined"==typeof o.markers[e].isBounce&&(o.markers[e].isBounce=!a);var n=o.markers[e];return n.isBounce==a?!1:(o.markers[e].isBounce=a,void(a?(n.setAnimation(google.maps.Animation.BOUNCE),o.map.panTo(n.getPosition())):n.setAnimation(null)))},clearMarker:function(){var e=this;$.each(e.markers,function(e,a){a.setMap(null)}),e.markers=[],e.mapBounds=!1,e.currentStores=[]},getLongLat:function(e,a){return new google.maps.LatLng(e,a)},computeDistance:function(e,a){var o=google.maps.geometry.spherical.computeDistanceBetween(e,a);return o/1e3}},$(function(){App.Maps.init()});