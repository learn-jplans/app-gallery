window.App=window.App||{},window.App.SearchPlace={init:function(){this.handler()},handler:function(){$(document).on("change","#searchPlaceType",function(e){console.log("handler..."),App.Maps.mapScriptLoaded()}),$(document).on("mouseover","#places li a",function(e){var o=$(this),a=o.data();App.Maps.bounceMarker(a.id,!0)}),$(document).on("mouseout","#places li a",function(e){var o=$(this),a=o.data();App.Maps.bounceMarker(a.id,!1)})}},$(function(){App.SearchPlace.init()}),window.App=window.App||{},window.App.Maps={$mapContainer:$("#map-canvas"),defaultZoomLevel:10,autoComplete:!1,region:"PH",map:!1,mapCenter:!1,markers:{},mapBounds:!1,userLocation:!1,currentLocation:!1,mapLoaded:!1,selectedLat:0,selectedLng:0,"default":{lat:13.9490476,lng:121.1579272,location:"Lipa Batangas, PH",zoomLevel:17},init:function(){var e=this;e.loadMapScript()},loadMapScript:function(){var e=document.createElement("script");e.type="text/javascript",e.src="//maps.googleapis.com/maps/api/js?v=3.exp&language=en&sensor=false&libraries=places,geometry&callback=App.Maps.mapScriptLoaded",document.body.appendChild(e)},mapScriptLoaded:function(){var e=this;e.loadMap(e.$mapContainer,null,function(e){e.getInitLocation(),e.mapLoaded=!0})},eventHandler:function(){var e=this;google.maps.event.addListener(e.map,"click",function(o){e.selectedLat=o.latLng.lat(),e.selectedLng=o.latLng.lng(),console.log(e.selectedLat),console.log(e.selectedLng)})},loadMap:function(e,o,a){var n=this;if(o=o||{},0===e.length)return!1;n["default"]=$.extend(n["default"],o),n.mapCenter=new google.maps.LatLng(n["default"].lat,n["default"].lng),n.currentLocation=n.mapCenter;var t={zoom:n["default"].zoomLevel,center:n.mapCenter,scrollwheel:!1,mapTypeControl:!1,panControl:!1,scaleControl:!0,zoomControl:!0,streetViewControl:!1,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.TOP_RIGHT}};e.ready(function(){n.map=new google.maps.Map(e[0],t),"function"==typeof a&&a(n)}),n.eventHandler()},getNearbyPlaces:function(){var e=this,o=$("#searchPlaceType option:selected").val();console.log(o),console.log(this.currentLocation);var a={location:this.currentLocation,radius:500,types:[o]};placesList=document.getElementById("places"),placesList.innerHTML="";var n=new google.maps.places.PlacesService(e.map);n.nearbySearch(a,function(o,a,n){a==google.maps.places.PlacesServiceStatus.OK&&(e.createMarkers(o),n.hasNextPage)})},createMarkers:function(e){console.log("marker..."),console.log(e.length);for(var o,a=this,n=(new google.maps.LatLngBounds,0);o=e[n];n++){var t=o.geometry.location;a.insertMarker(t,o.id),placesList.innerHTML+='<li><a href="javascript:;" data-id="'+o.id+'">'+o.name+"</a></li>"}},getInitLocation:function(e,o){var a=this;o?(a.mapCenter=new google.maps.LatLng(e,o),a.currentLocation=a.mapCenter,a.userLocation=a.mapCenter,a.map.setZoom(a["default"].zoomLevel),a.map.setCenter(a.mapCenter),a.geolocationInProgress=!1,a.initDefaultGeoInterval=setInterval(function(){a.geolocationInProgress||clearInterval(a.initDefaultGeoInterval)},200)):navigator.geolocation&&(a.geolocationInProgress=!0,navigator.geolocation.getCurrentPosition(function(e){console.log(e),a.mapCenter=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),a.currentLocation=a.mapCenter,a.userLocation=a.mapCenter,a.map.setZoom(a["default"].zoomLevel),a.map.setCenter(a.mapCenter),a.geolocationInProgress=!1,a.getNearbyPlaces()},function(e){a.geolocationInProgress=!1},{maximumAge:6e5,timeout:1e4}),a.initDefaultGeoInterval=setInterval(function(){a.geolocationInProgress||clearInterval(a.initDefaultGeoInterval)},200))},insertMarker:function(e,o){var a=this;if(a.mapLoaded){var n=new google.maps.Marker({position:e,map:a.map,tag:o});a.markers[String(o)]=n}else setTimeout(function(){a.insertMarker(e,o)},100)},addMarker:function(e,o,a){var n=this;if(0==e||0==o)return!1;if(n.mapLoaded){var t=new google.maps.LatLng(e,o),r=new google.maps.Marker({position:t,map:n.map,tag:"ticket-"+a});n.markers[String(a)]=r}else setTimeout(function(){n.addMarker(e,o,a)},100)},bounceMarker:function(e,o){var a=this;if("undefined"==typeof a.markers[e])return!1;"undefined"==typeof a.markers[e].isBounce&&(a.markers[e].isBounce=!o);var n=a.markers[e];return n.isBounce==o?!1:(a.markers[e].isBounce=o,void(o?(n.setAnimation(google.maps.Animation.BOUNCE),a.map.panTo(n.getPosition())):n.setAnimation(null)))},clearMarker:function(){var e=this;$.each(e.markers,function(e,o){o.setMap(null)}),e.markers=[],e.mapBounds=!1,e.currentStores=[]},getLongLat:function(e,o){return new google.maps.LatLng(e,o)},computeDistance:function(e,o){var a=google.maps.geometry.spherical.computeDistanceBetween(e,o);return a/1e3}},$(function(){App.Maps.init()});